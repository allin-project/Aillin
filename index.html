<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스포츠 커뮤니티 프로토타입</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    
    <link rel="icon" href="logo.png" type="image/png">
    
    <style>
        /* CSS는 이전과 동일합니다. */
/* === 전체 스타일 개선 === */

/* 1. 구글 웹폰트 추가 (Poppins: 제목용, Noto Sans KR: 본문용) */
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Poppins:wght@600;700;800&display=swap');

/* 2. CSS 변수를 사용한 체계적인 색상 관리 */
:root {
    --primary-color: #059669; /* 기존 녹색 */
    --primary-dark: #047857;
    --primary-light: #d1fae5;
    --secondary-color: #3b82f6; /* 활기를 더해줄 파란색 */
    
    --text-color: #1e293b;
    --text-light: #475569;
    --border-color: #e2e8f0;
    --background-light: #f1f5f9;
    --background-white: #ffffff;

    --danger-color: #ef4444;

    --font-heading: 'Poppins', 'Noto Sans KR', sans-serif;
    --font-body: 'Noto Sans KR', sans-serif;
    
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    
    --border-radius: 0.75rem; /* 전반적인 둥근 모서리 값 증가 */
}

/* 3. 기본 스타일 및 전환 효과 설정 */
* {
    transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
}

body { 
    font-family: var(--font-body); 
    background-color: var(--background-light); 
    color: var(--text-color); 
    display: flex; 
    flex-direction: column; 
    min-height: 100vh; 
    margin: 0; 
}
.container { width: 100%; max-width: 1280px; margin-left: auto; margin-right: auto; padding: 1rem; flex-grow: 1; }
.view { display: none; }
.view.active { display: block; animation: fadeIn 0.5s ease-in-out; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

/* === 헤더 및 네비게이션 === */
.header { 
    display: flex; 
    flex-direction: column; 
    justify-content: space-between; 
    align-items: center; 
    margin-bottom: 2rem; 
    padding-bottom: 1.5rem; 
    border-bottom: 1px solid var(--border-color); 
}
.header h1 { 
    font-family: var(--font-heading);
    font-size: 2.25rem; /* 제목 폰트 크기 증가 */
    font-weight: 800; 
    color: var(--text-color); 
    cursor: pointer; 
    margin-bottom: 1rem; 
}
.search-area {
    display: flex; /* flexbox 레이아웃 적용 */
    align-items: center;
    width: 320px; /* 검색창의 전체 너비를 지정 (조절 가능) */
}

.search-area input { 
    padding: 0.75rem 1rem; 
    border: 1px solid var(--border-color); 
    border-radius: var(--border-radius); 
    /* width: 100%; 삭제 */
    flex-grow: 1; /* 남는 공간을 모두 차지하도록 설정 */
    border-right: none; /* 버튼과 이어지도록 오른쪽 테두리 제거 */
    border-top-right-radius: 0; /* 오른쪽 모서리 각 제거 */
    border-bottom-right-radius: 0;
}
.search-area input:focus { 
    outline: none; 
    box-shadow: 0 0 0 3px var(--primary-light); 
    border-color: var(--primary-color);
}
.search-area button { 
    padding: 0.75rem 1rem; 
    background-color: var(--primary-color); /* 테마 색상으로 변경 */
    color: white; 
    border: 1px solid var(--primary-color); /* 테두리 추가 */
    border-radius: var(--border-radius); 
    cursor: pointer; 
    font-weight: 600;
    flex-shrink: 0; /* 버튼 크기가 줄어들지 않도록 설정 */
    border-top-left-radius: 0; /* 왼쪽 모서리 각 제거 */
    border-bottom-left-radius: 0;
}
.search-area button:hover { 
    background-color: var(--primary-dark); /* 호버 색상 변경 */
    border-color: var(--primary-dark);
}
.user-menu { display: flex; gap: 1rem; margin-top: 1rem; align-items: center; }
.user-menu span { font-weight: 600; }
.user-menu a, .user-menu button { 
    color: var(--text-light); 
    text-decoration: none; 
    background: none; border: none; 
    cursor: pointer; font-size: 1em; 
    font-family: inherit; font-weight: 600; padding: 0.5rem;
    border-radius: 0.5rem;
}
.user-menu a:hover, .user-menu button:hover { color: var(--primary-color); background-color: var(--primary-light); }

.main-nav { 
    background-color: var(--background-white); 
    border-radius: var(--border-radius); 
    box-shadow: var(--shadow-md); 
    padding: 0.5rem; 
    margin-bottom: 2.5rem; 
}
.main-nav ul { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 0.5rem; font-weight: 700; list-style: none; padding: 0; margin: 0; }
.nav-link { 
    padding: 0.75rem 1.25rem; /* 네비게이션 링크 패딩 조정 */
    display: block; 
    color: var(--text-light); 
    border-radius: 0.5rem; 
    text-decoration: none; 
    cursor: pointer; 
    position: relative;
}
.nav-link:hover { 
    color: var(--primary-dark); 
    background-color: var(--background-light); 
}
.nav-link.active { 
    color: var(--primary-color); 
    font-weight: 700; 
}
/* 활성 링크 밑줄 효과 추가 */
.nav-link.active::after {
    content: '';
    position: absolute;
    bottom: 5px;
    left: 1.25rem;
    right: 1.25rem;
    height: 3px;
    background-color: var(--primary-color);
    border-radius: 2px;
}
.sports-gallery-menu { position: relative; }
.sports-gallery-toggle { display: flex; align-items: center; }
.sports-gallery-toggle svg { width: 1rem; height: 1rem; margin-left: 0.25rem; color: #64748b; }
.sports-gallery-dropdown { 
    position: absolute; display: none; 
    margin-top: 0.75rem; width: 12rem; 
    background-color: var(--background-white); 
    border-radius: var(--border-radius); 
    box-shadow: var(--shadow-lg); z-index: 10; 
    border: 1px solid var(--border-color); 
    padding: 0.5rem; /* 드롭다운 메뉴 패딩 추가 */
    overflow: hidden; /* 애니메이션을 위해 */
}
.sports-gallery-dropdown.show { display: block; animation: dropdown-show 0.2s ease-out; }
@keyframes dropdown-show { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
.sports-gallery-dropdown .nav-link { font-size: 0.9rem; font-weight: 500; }
.sports-gallery-dropdown .nav-link.active::after { display: none; } /* 드롭다운 내부는 밑줄 제거 */
.sports-gallery-dropdown .nav-link:hover { color: var(--primary-color); }


/* === 메인 콘텐츠 섹션 === */
main section { margin-bottom: 3.5rem; }
main h2 { 
    font-family: var(--font-heading);
    font-size: 1.875rem; 
    font-weight: 700; 
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--border-color);
}

/* === 카드 디자인 개선 (그림자, 호버 효과) === */
.match-schedule { display: grid; gap: 1.5rem; }
.match-card { 
    background-color: var(--background-white); 
    padding: 1.5rem; 
    border-radius: var(--border-radius); 
    box-shadow: var(--shadow-md);
    border: none;
    cursor: pointer;
}
.match-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}
.match-card-header { 
    display: flex; justify-content: space-between; 
    align-items: center; font-size: 0.875rem; 
    color: var(--text-light); margin-bottom: 1rem; 
    font-weight: 600;
}
.match-card-header .status { font-weight: 700; padding: 0.25rem 0.75rem; border-radius: 999px; color: white; }
.match-card-header .status.live { background-color: var(--danger-color); }
.match-card-header .status.finished { background-color: var(--text-light); }
.match-card-body { display: flex; align-items: center; justify-content: space-between; }
.match-card-body .team { font-weight: 700; font-size: 1.25rem; flex: 1; text-align: center; }
.match-card-body .score { font-family: var(--font-heading); font-weight: 800; font-size: 2rem; color: var(--primary-color); margin: 0 1rem; }

/* === 인기글 목록 개선 === */
.popular-posts { 
    background-color: var(--background-white); 
    padding: 1.5rem; 
    border-radius: var(--border-radius); 
    box-shadow: var(--shadow-md); 
}
.popular-posts ul { list-style: none; padding: 0; margin: 0; }
.popular-posts li { 
    padding: 0.75rem 0.25rem; 
    border-bottom: 1px solid var(--background-light); 
    font-size: 1rem;
}
.popular-posts li:last-child { border-bottom: none; }
.popular-posts a { text-decoration: none; color: inherit; display: block; }
.popular-posts a:hover { color: var(--primary-color); transform: translateX(4px); }
.popular-posts .board-name { font-weight: 700; color: var(--secondary-color); }
.popular-posts .comment-count { font-weight: 600; color: var(--danger-color); margin-left: 0.25rem; font-size: 0.9em;}


/* === 게시판 목록 개선 === */
.board-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
.write-btn { 
    background-color: var(--primary-color); 
    color: white; 
    padding: 0.75rem 1.5rem; 
    border-radius: 0.5rem; 
    font-weight: 700; 
    border: none; 
    cursor: pointer;
    box-shadow: var(--shadow-sm);
}
.write-btn:hover { background-color: var(--primary-dark); box-shadow: var(--shadow-md); }
.table-container { 
    background-color: var(--background-white); 
    border-radius: var(--border-radius); 
    box-shadow: var(--shadow-md); 
    overflow: hidden; /* radius 적용을 위해 */
}
.post-table { width: 100%; font-size: 0.9rem; text-align: center; border-collapse: collapse; }
.post-table thead { 
    font-size: 0.8rem; 
    color: var(--text-color); 
    text-transform: uppercase; 
    background-color: var(--background-light); 
    font-family: var(--font-heading);
}
.post-table th, .post-table td { padding: 1rem 1.5rem; }
.post-table th:nth-child(2), .post-table td:nth-child(2) { text-align: left; } /* 제목은 왼쪽 정렬 */
.post-table tbody tr { border-bottom: 1px solid var(--background-light); }
.post-table tbody tr:last-child { border-bottom: none; }
.post-table tbody tr:hover { background-color: var(--primary-light); cursor: pointer; }
.pagination { display: flex; justify-content: center; margin-top: 1.5rem; }
.pagination button { 
    padding: 0.5rem 1rem; 
    margin: 0 0.25rem; 
    border-radius: 0.5rem; 
    border: 1px solid var(--border-color); 
    background-color: var(--background-white); 
    color: var(--text-light); 
    cursor: pointer;
    font-weight: 600;
}
.pagination button:hover { background-color: var(--background-light); border-color: var(--primary-color); }
.pagination button.active { 
    background-color: var(--primary-color); 
    color: white; 
    border-color: var(--primary-color); 
    box-shadow: var(--shadow-md);
}

/* === 모달 개선 === */
.modal-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.6); display: none; align-items: center; justify-content: center; z-index: 50; backdrop-filter: blur(4px); }
.modal-overlay.show { display: flex; animation: fadeIn 0.3s; }
.modal-box { 
    background-color: var(--background-white); 
    padding: 2rem; 
    border-radius: var(--border-radius); 
    box-shadow: var(--shadow-lg); 
    width: 100%; max-width: 420px;
    animation: slideUp 0.4s ease-out;
}
@keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
.modal-header h2 { font-size: 1.5rem; font-weight: 700; font-family: var(--font-heading); }
.modal-close-btn { font-size: 2rem; color: #9ca3af; cursor: pointer; border: none; background: none; line-height: 1; }
.modal-close-btn:hover { color: var(--text-color); }
.modal-body .form-group { margin-bottom: 1.25rem; }
.modal-body label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
.modal-body input { width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 0.5rem; box-sizing: border-box; }
.modal-body input:focus { border-color: var(--primary-color); outline: none; box-shadow: 0 0 0 3px var(--primary-light); }
.modal-body button { 
    width: 100%; padding: 0.875rem; 
    border-radius: 0.5rem; 
    background-color: var(--primary-color); 
    color: white; 
    font-weight: 700; font-size: 1rem;
    border: none; cursor: pointer; 
}
.modal-body button:hover { background-color: var(--primary-dark); }

/* === 푸터 개선 === */
.footer { background-color: #0f172a; color: #cbd5e1; margin-top: 3rem; }
.footer .container { padding: 2.5rem 1rem; text-align: center; font-size: 0.875rem; }
.footer p { margin-bottom: 0.5rem; }
.footer .links { display: flex; justify-content: center; gap: 1.5rem; margin-bottom: 1rem; }
.footer a { color: #cbd5e1; text-decoration: none; }
.footer a:hover { color: white; text-decoration: underline; }
.footer .copyright { color: #64748b; font-size: 0.8rem; }

/* === 글쓰기/게시물 보기 화면 개선 === */
#write-form, #post-content-view { 
    padding: 2.5rem; 
    background-color: var(--background-white); 
    border-radius: var(--border-radius); 
    box-shadow: var(--shadow-md); 
}
#write-form input, #write-form textarea { 
    width: 100%; padding: 0.75rem; 
    border: 1px solid var(--border-color); 
    border-radius: 0.5rem; 
    box-sizing: border-box; 
    margin-bottom: 1.5rem; 
}
#write-form input:focus, #write-form textarea:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 3px var(--primary-light);
}
#write-form textarea { min-height: 300px; resize: vertical; }
#write-form .form-actions { text-align: right; display: flex; gap: 1rem; justify-content: flex-end; }

#post-content-view h1 { font-family: var(--font-heading); font-size: 2.5rem; margin-bottom: 1rem; }
#post-meta { color: var(--text-light); margin-bottom: 2rem; }
#post-body { 
    line-height: 1.8; 
    font-size: 1.1rem; /* 본문 가독성 향상 */
    min-height: 200px; 
    border-top: 1px solid var(--border-color); 
    border-bottom: 1px solid var(--border-color); 
    padding: 2.5rem 0; 
    margin-bottom: 2rem;
}

/* === 댓글 기능 CSS === */
#comments-section { margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid var(--border-color); }
#comments-section h3 { font-size: 1.5rem; margin-bottom: 1.5rem; font-family: var(--font-heading); }
#comments-list { list-style: none; padding: 0; }
.comment-item { padding: 1.25rem; border-bottom: 1px solid var(--background-light); background-color: transparent; border-radius: 0.5rem; }
.comment-item:last-child { border-bottom: none; }
.comment-item:hover { background-color: var(--background-light); }
.comment-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem; }
.comment-author { font-weight: 700; }
.comment-date { font-size: 0.875rem; color: var(--text-light); }
.comment-body { margin-bottom: 0.75rem; color: #334155; }
.comment-actions button { background: none; border: none; color: var(--text-light); font-size: 0.875rem; cursor: pointer; padding: 0.25rem; font-weight: 600; }
.comment-actions button:hover { color: var(--primary-color); }

.reply-list { 
    list-style: none; 
    padding-left: 1.5rem; 
    border-left: 3px solid var(--border-color); 
    margin-top: 1rem; 
    margin-left: 1rem;
}

.comment-form { display: flex; gap: 0.75rem; margin-top: 1.5rem; align-items: flex-start; }
.comment-form textarea { 
    flex-grow: 1; border: 1px solid var(--border-color); 
    border-radius: 0.5rem; padding: 0.75rem; 
    resize: vertical; min-height: 48px; 
    background-color: var(--background-white);
}
.comment-form textarea:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 3px var(--primary-light);
}
.comment-form button { flex-shrink: 0; align-self: flex-end; }
.reply-form-container { padding-left: 0; margin-top: 1rem; }

/* === 반응형 웹 디자인 === */
@media (min-width: 640px) { 
    .header { flex-direction: row; } 
    .header h1 { margin-bottom: 0; } 
    .user-menu { margin-top: 0; } 
    .main-nav ul { justify-content: flex-start; flex-wrap: nowrap; } 
    .search-area { width: auto; }
}
@media (min-width: 768px) { 
    .match-schedule { grid-template-columns: repeat(2, minmax(0, 1fr)); } 
    .photo-gallery { grid-template-columns: repeat(4, minmax(0, 1fr)); } 
}
@media (min-width: 1024px) { 
    .match-schedule { grid-template-columns: repeat(3, minmax(0, 1fr)); } 
}


/* === 카드형 게시판 목록 스타일 === */
.post-list-cards {
    display: grid;
    gap: 1.5rem;
}
.post-card {
    background-color: var(--background-white);
    padding: 1.5rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-md);
    cursor: pointer;
    border-left: 5px solid transparent;
    transition: transform 0.2s, box-shadow 0.2s, border-left-color 0.2s;
}
.post-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
    border-left-color: var(--primary-color);
}
.post-card-title {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}
.post-card-meta {
    font-size: 0.875rem;
    color: var(--text-light);
    margin-bottom: 1rem;
}
.post-card-stats {
    display: flex;
    gap: 1rem;
    font-size: 0.9rem;
    color: var(--text-light);
}
/* 기존 CSS는 위에서 모두 덮어썼습니다. */
/* 추천/비추천 버튼은 JS에서 style을 직접 제어하므로 그대로 둡니다. */

        /* === 댓글 기능 CSS 추가 END === */
   </style>
</head>
<body>

    <div id="app" class="container">
        
<header class="header">
    <h1 id="logo">올 인 人</h1>

    <form id="search-form" class="search-area">
        <input type="text" id="search-input" placeholder="게시물 제목 검색..." required>
        <button type="submit">검색</button>
    </form>

    <div id="user-menu-container" class="user-menu">
        </div>
</header>

        <nav class="main-nav">
            <ul>
                <li><a href="#" class="nav-link" data-board="freeboard">자유게시판</a></li>
                <li class="sports-gallery-menu" id="sports-gallery-menu">
                    <a href="#" id="sports-gallery-toggle" class="nav-link sports-gallery-toggle" data-board-group="sports">
                        스포츠갤러리
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </a>
                    <div id="sports-gallery-dropdown" class="sports-gallery-dropdown">
                        <a href="#" class="nav-link" data-board="soccer">축구</a>
                        <a href="#" class="nav-link" data-board="baseball">야구</a>
                        <a href="#" class="nav-link" data-board="basketball">농구</a>
                        <a href="#" class="nav-link" data-board="esports">e스포츠</a>
                    </div>
                </li>
                <li><a href="#" class="nav-link" data-main-nav-link="true" data-board="announcements">공지사항</a></li>
            </ul>
        </nav>

<main>
    <div id="main-view" class="view active">
        <section>
            <h2>주요 경기</h2>
            <div id="match-schedule" class="match-schedule"></div>
        </section>
        <section>
            <h2>커뮤니티 인기글</h2>
            <div id="popular-posts" class="popular-posts"></div>
        </section>
        <section>
    <h2>🤖 AI 승부 예측</h2>
    <div id="prediction-ui" style="background-color: white; padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);">
        <div style="display: flex; gap: 1rem; margin-bottom: 1rem; align-items: center; flex-wrap: wrap;">
            <select id="ai-sport-select" style="padding: 0.5rem; border: 1px solid #cbd5e1; border-radius: 0.5rem;">
                <option value="soccer">축구</option>
                <option value="baseball">야구</option>
                <option value="basketball">농구</option>
                <option value="esports">e스포츠</option>
            </select>
            <input type="text" id="ai-team-a" placeholder="팀 A 이름" style="flex-grow: 1; padding: 0.5rem; border: 1px solid #cbd5e1; border-radius: 0.5rem;">
            <span style="font-weight: 700;">VS</span>
            <input type="text" id="ai-team-b" placeholder="팀 B 이름" style="flex-grow: 1; padding: 0.5rem; border: 1px solid #cbd5e1; border-radius: 0.5rem;">
            <button id="ai-predict-btn" class="write-btn">예측하기</button>
        </div>
        <div id="ai-prediction-result" style="margin-top: 1rem; padding: 1rem; border: 1px dashed #e2e8f0; border-radius: 0.5rem; min-height: 50px; white-space: pre-wrap; line-height: 1.6;">
            결과가 여기에 표시됩니다.
        </div>
    </div>
</section>
    </div>

<div id="board-view" class="view">
    <div class="board-header">
        <h2 id="board-title"></h2>
        <button id="write-post-btn" class="write-btn">글쓰기</button>
    </div>
    <div id="post-list-cards" class="post-list-cards">
        </div>
    <div id="pagination" class="pagination"></div>
</div>

    <div id="post-view" class="view">
        </div>

    <div id="write-view" class="view">
        </div>

    <div id="search-results-view" class="view">
        </div>
</main>
    </div>
    
    <div id="login-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header"><h2>로그인</h2><button class="modal-close-btn">&times;</button></div>
            <div class="modal-body">
                <form id="login-form">
                    <div class="form-group"><label for="login-email">이메일</label><input type="email" id="login-email" required></div>
                    <div class="form-group"><label for="login-password">비밀번호</label><input type="password" id="login-password" required></div>
                    <button type="submit">로그인</button>
                </form>
            </div>
        </div>
    </div>
    <div id="signup-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header"><h2>회원가입</h2><button class="modal-close-btn">&times;</button></div>
            <div class="modal-body">
               <form id="signup-form">
                    <div class="form-group"><label for="signup-nickname">닉네임</label><input type="text" id="signup-nickname" required></div>
                    <div class="form-group"><label for="signup-email">이메일</label><input type="email" id="signup-email" required></div>
                    <div class="form-group"><label for="signup-password">비밀번호</label><input type="password" id="signup-password" minlength="6" required></div>
                    <button type="submit">가입하기</button>
               </form>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p style="font-weight: 700;">올 인 人</p>
            <div class="links">
                <a href="#">회사소개</a><a href="#">이용약관</a><a href="#">개인정보처리방침</a><a href="#">고객센터</a>
            </div>
            <p class="copyright">© 2025 All In 人. All Rights Reserved.</p>
        </div>
    </footer>

<script type="module">
    // Firebase SDK IMPORTS
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { 
        getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, 
        onAuthStateChanged, signOut, updateProfile
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { 
        getFirestore, doc, setDoc, getDoc, getDocs, collection, 
        query, where, orderBy, limit, addDoc, serverTimestamp, increment, updateDoc,
        runTransaction, deleteDoc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // FIREBASE CONFIG
    const firebaseConfig = {
        apiKey: "AIzaSyAUuUlYHUwOuwnm_hsIsd7XHlj5voCecQk",
        authDomain: "community-d18d4.firebaseapp.com",
        projectId: "community-d18d4",
        storageBucket: "community-d18d4.appspot.com",
        messagingSenderId: "497702481194",
        appId: "1:497702481194:web:a826db91628adc24718253"
    };

    // FIREBASE INITIALIZATION
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // APP STATE
    const appState = {
        currentUser: null,
        currentView: 'main-view',
        currentBoard: null,
        currentPostId: null,
        currentPage: 1,
        postsPerPage: 10,
    };
    
    const boardNames = {
        freeboard: '자유게시판', announcements: '공지사항', soccer: '축구', 
        baseball: '야구', basketball: '농구', esports: 'e스포츠',
    };

    // === Firestore 데이터 로드 함수 ===
    
    async function fetchMatches() {
        const matchesCol = collection(db, 'matches');
        const q = query(matchesCol, orderBy('time', 'desc'), limit(6));
        const snapshot = await getDocs(q);
        return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    }
    
    async function fetchPopularPosts() {
        const postsCol = collection(db, 'posts');
        const q = query(postsCol, orderBy('likes', 'desc'), limit(5));
        const snapshot = await getDocs(q);
        return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    }
    
    async function fetchPhotos() {
        return [
            { id: 1, src: 'https://placehold.co/600x400/10b981/ffffff?text=환호하는+선수들', caption: '극적인 역전골!', board: 'soccer' },
            { id: 2, src: 'https://placehold.co/600x400/ef4444/ffffff?text=홈런+세리머니', caption: '짜릿한 끝내기 홈런', board: 'baseball' },
            { id: 3, src: 'https://placehold.co/600x400/8b5cf6/ffffff?text=슬램덩크', caption: '엄청난 덩크슛', board: 'basketball' },
            { id: 4, src: 'https://placehold.co/600x400/3b82f6/ffffff?text=우승+트로피', caption: '감격의 우승 순간', board: 'esports' },
        ];
    }

    async function fetchPostsForBoard(boardId, page = 1) {
        const postsCol = collection(db, 'posts');
        const q = query(postsCol, where("board", "==", boardId), orderBy("createdAt", "desc"), limit(appState.postsPerPage));
        const snapshot = await getDocs(q);
        return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    }

    async function fetchSearchResults(queryText) {
        const postsRef = collection(db, "posts");
        const q = query(postsRef, 
            where("title", ">=", queryText),
            where("title", "<=", queryText + '\uf8ff'),
            orderBy("title"),
            limit(20)
        );
        const snapshot = await getDocs(q);
        return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    }

    // === UI 렌더링 함수 ===

    function showView(viewId) {
        document.querySelectorAll('.view').forEach(view => view.classList.remove('active'));
        const viewToShow = document.getElementById(viewId);
        if(viewToShow) {
            viewToShow.classList.add('active');
            appState.currentView = viewId;
            window.scrollTo(0, 0);
        }
    }

    async function renderMainView() {
        showView('main-view');
        
        const matches = await fetchMatches();
        const matchContainer = document.getElementById('match-schedule');
        matchContainer.innerHTML = matches.map(match => `
            <div class="match-card">
                <div class="match-card-header">
                    <span>${boardNames[match.sport] || match.sport}</span>
                    <span class="status ${match.time === '종료' ? 'finished' : 'live'}">${match.time}</span>
                </div>
                <div class="match-card-body">
                    <span class="team">${match.teamA}</span>
                    <span class="score">${match.scoreA} : ${match.scoreB}</span>
                    <span class="team">${match.teamB}</span>
                </div>
            </div>
        `).join('') || "<p>등록된 경기가 없습니다.</p>";

        const popularPosts = await fetchPopularPosts();
        const popularPostsContainer = document.getElementById('popular-posts');
        popularPostsContainer.innerHTML = `<ul>${popularPosts.map(post => `
            <li>
                <a href="#" class="post-link" data-post-id="${post.id}" data-board="${post.board}">
                    <span class="board-name">[${boardNames[post.board]}]</span> ${post.title} 
                    <span class="comment-count">[${post.commentCount || 0}]</span>
                </a>
            </li>
        `).join('')}</ul>` || "<p>인기글이 없습니다.</p>";

        const photos = await fetchPhotos();
        document.getElementById('photo-gallery').innerHTML = photos.map(photo => `
            <div class="photo-card">
                <img src="${photo.src}" alt="${photo.caption}">
                <div class="caption"><p>${photo.caption}</p></div>
            </div>
        `).join('');
    }



    // === AI 승부 예측 기능 추가 START ===

async function handlePrediction(e) {
    const sport = document.getElementById('ai-sport-select').value;
    const teamA = document.getElementById('ai-team-a').value.trim();
    const teamB = document.getElementById('ai-team-b').value.trim();
    const resultDiv = document.getElementById('ai-prediction-result');
    const predictBtn = document.getElementById('ai-predict-btn');

    if (!teamA || !teamB) {
        alert('팀 이름을 모두 입력해주세요!');
        return;
    }

    // 로딩 상태 표시
    resultDiv.textContent = '🧠 AI가 열심히 분석 중입니다...';
    predictBtn.disabled = true;
    predictBtn.textContent = '분석중...';

    try {
        const response = await fetch('/api/predict', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ sport, teamA, teamB }),
        });

        const data = await response.json();

        if (!response.ok) {
            throw new Error(data.error || '알 수 없는 오류가 발생했습니다.');
        }

        resultDiv.textContent = data.prediction;

    } catch (error) {
        console.error('Prediction Error:', error);
        resultDiv.textContent = `오류 발생: ${error.message}`;
    } finally {
        // 로딩 상태 해제
        predictBtn.disabled = false;
        predictBtn.textContent = '예측하기';
    }
}

// 예측 버튼에 이벤트 리스너 연결
// 이 코드는 renderMainView 함수가 호출된 후에 실행되어야 하므로,
// 초기 렌더링 후 이벤트 리스너를 한 번만 추가해줍니다.
document.addEventListener('DOMContentLoaded', () => {
    // 버튼이 나중에 생성될 수 있으므로 상위 요소에 이벤트 위임을 사용합니다.
    document.body.addEventListener('click', function(event) {
        if (event.target && event.target.id === 'ai-predict-btn') {
            handlePrediction();
        }
    });
});


    
    async function renderBoardView(boardId, page) {
        appState.currentBoard = boardId;
        appState.currentPage = page;
        showView('board-view');
        document.getElementById('board-title').textContent = boardNames[boardId] + " 게시판";
        
        const postListContainer = document.getElementById('post-list-cards');
        const formatDate = (timestamp) => timestamp ? new Date(timestamp.seconds * 1000).toLocaleDateString('ko-KR') : '방금';
        const posts = await fetchPostsForBoard(boardId, page);

        if (posts.length === 0) {
            postListContainer.innerHTML = '<p style="text-align:center; padding: 2rem 0;">게시글이 없습니다.</p>';
            return;
        }

        postListContainer.innerHTML = posts.map(post => `
            <div class="post-card post-link" data-post-id="${post.id}" data-board="${post.board}">
                <h3 class="post-card-title">${post.title}</h3>
                <div class="post-card-meta">
                    <span>${post.authorName}</span> ・ <span>${formatDate(post.createdAt)}</span>
                </div>
                <div class="post-card-stats">
                    <span>👁️ ${post.views || 0}</span>
                    <span>👍 ${post.likes || 0}</span>
                    <span>💬 ${post.commentCount || 0}</span>
                </div>
            </div>
        `).join('');
    }

    function renderWriteView() {
        const boardId = appState.currentBoard;
        if (!appState.currentUser) {
            alert("로그인이 필요합니다.");
            return;
        }
        showView('write-view');
        const writeView = document.getElementById('write-view');
        writeView.innerHTML = `
            <h2>${boardNames[boardId]} 글쓰기</h2>
            <form id="write-form">
                <input type="text" id="write-title" placeholder="제목을 입력하세요" required>
                <textarea id="write-content" placeholder="내용을 입력하세요" required></textarea>
                <div class="form-actions">
                    <button type="button" id="cancel-write-btn" class="write-btn" style="background-color:#64748b;">취소</button>
                    <button type="submit" class="write-btn">등록</button>
                </div>
            </form>
        `;
        document.getElementById('write-form').addEventListener('submit', handlePostSubmit);
        document.getElementById('cancel-write-btn').addEventListener('click', () => renderBoardView(appState.currentBoard, 1));
    }

    async function renderEditView(postId) {
        showView('write-view');
        const writeView = document.getElementById('write-view');
        
        const postRef = doc(db, "posts", postId);
        const postSnap = await getDoc(postRef);
        if (!postSnap.exists()) {
            alert("수정할 게시물을 찾을 수 없습니다.");
            renderBoardView(appState.currentBoard, 1);
            return;
        }
        const post = postSnap.data();

        writeView.innerHTML = `
            <h2>게시물 수정</h2>
            <form id="edit-form" data-post-id="${postId}">
                <input type="text" id="edit-title" placeholder="제목을 입력하세요" value="${post.title}" required>
                <textarea id="edit-content" placeholder="내용을 입력하세요" required>${post.content}</textarea>
                <div class="form-actions">
                    <button type="button" id="cancel-edit-btn" class="write-btn" style="background-color:#64748b;">취소</button>
                    <button type="submit" class="write-btn">수정하기</button>
                </div>
            </form>
        `;
        document.getElementById('edit-form').addEventListener('submit', handlePostUpdate);
        document.getElementById('cancel-edit-btn').addEventListener('click', () => renderPostView(post.board, postId));
    }

    async function renderPostView(boardId, postId) {
        showView('post-view');
        appState.currentPostId = postId;
        const postRef = doc(db, "posts", postId);
        
        const postSnapForViewCount = await getDoc(postRef);
        if (postSnapForViewCount.exists() && postSnapForViewCount.data().authorId !== appState.currentUser?.uid) {
            await updateDoc(postRef, { views: increment(1) });
        }
        
        const postSnap = await getDoc(postRef);

        if (postSnap.exists()) {
            const post = postSnap.data();
            const postView = document.getElementById('post-view');
            const formatDate = (timestamp) => timestamp ? new Date(timestamp.seconds * 1000).toLocaleString('ko-KR') : '';
            
            const isAuthor = appState.currentUser && appState.currentUser.uid === post.authorId;
            const authorButtons = `
                <button id="edit-post-btn" class="write-btn" style="background-color: var(--secondary-color);">수정</button>
                <button id="delete-post-btn" class="write-btn" style="background-color: var(--danger-color);">삭제</button>
            `;

            postView.innerHTML = `
                <div id="post-content-view">
                    <h1>${post.title}</h1>
                    <div id="post-meta">
                        <span>작성자: ${post.authorName}</span> | 
                        <span>작성일: ${formatDate(post.createdAt)}</span> |
                        <span>조회: ${post.views || 0}</span>
                    </div>
                    <div id="post-body">${post.content.replace(/\n/g, '<br>')}</div>
                    <div id="vote-bar" style="display:flex; gap:.5rem; align-items:center; margin:1rem 0;">
                        <button id="like-btn" class="write-btn" style="background:#16a34a;">
                            👍 추천 <span id="like-count">${post.likes || 0}</span>
                        </button>
                        <button id="dislike-btn" class="write-btn" style="background:#ef4444;">
                            👎 비추천 <span id="dislike-count">${post.dislikes || 0}</span>
                        </button>
                    </div>
                    <div class="form-actions" style="margin-top: 2rem; justify-content: flex-start;">
                        <button id="back-to-list-btn" class="write-btn" style="background-color:#64748b; margin-right: auto;">목록으로</button>
                        ${isAuthor ? authorButtons : ''}
                    </div>
                </div>
                <div id="comments-section">
                    <h3>댓글</h3>
                    <ul id="comments-list"></ul>
                    ${appState.currentUser ? `
                        <form id="comment-form" class="comment-form">
                            <textarea id="comment-text" placeholder="댓글을 입력하세요..." required></textarea>
                            <button type="submit" class="write-btn">등록</button>
                        </form>
                    ` : `<p style="text-align:center; color:#64748b;">댓글을 작성하려면 로그인이 필요합니다.</p>`}
                </div>
            `;
            
            setupVoteUI(postId);
            renderComments(postId);
            
            document.getElementById('back-to-list-btn').addEventListener('click', () => renderBoardView(boardId, 1));
            if (appState.currentUser) {
                document.getElementById('comment-form')?.addEventListener('submit', (e) => handleCommentSubmit(e, postId));
            }
            if (isAuthor) {
                document.getElementById('edit-post-btn').addEventListener('click', () => renderEditView(postId));
                document.getElementById('delete-post-btn').addEventListener('click', () => handlePostDelete(postId, boardId));
            }
        } else {
            alert("게시물을 찾을 수 없습니다.");
            renderBoardView(boardId, 1);
        }
    }

    function renderSearchResultsView(results, queryText) {
        showView('search-results-view');
        const container = document.getElementById('search-results-view');
        
        let resultsHtml = `<h2>'${queryText}' 검색 결과</h2>`;
        if (results.length === 0) {
            resultsHtml += '<p style="text-align:center; padding: 2rem 0;">검색 결과가 없습니다.</p>';
        } else {
            resultsHtml += `<div class="popular-posts"><ul>`;
            resultsHtml += results.map(post => `
                <li>
                    <a href="#" class="post-link" data-post-id="${post.id}" data-board="${post.board}">
                        <span class="board-name">[${boardNames[post.board]}]</span> ${post.title}
                        <span class="comment-count">[${post.commentCount || 0}]</span>
                    </a>
                </li>
            `).join('');
            resultsHtml += `</ul></div>`;
        }
        container.innerHTML = resultsHtml;
    }
    
    // === 댓글 기능 함수 ===

    async function renderComments(postId) {
        const commentsList = document.getElementById('comments-list');
        if (!commentsList) return;
        commentsList.innerHTML = '<li>댓글을 불러오는 중...</li>';

        const commentsCol = collection(db, "posts", postId, "comments");
        const q = query(commentsCol, orderBy("createdAt"));
        const snapshot = await getDocs(q);
        
        const commentsMap = new Map();
        snapshot.docs.forEach(doc => {
            commentsMap.set(doc.id, { id: doc.id, children: [], ...doc.data() });
        });

        const rootComments = [];
        commentsMap.forEach(comment => {
            if (comment.parentId && commentsMap.has(comment.parentId)) {
                commentsMap.get(comment.parentId).children.push(comment);
            } else {
                rootComments.push(comment);
            }
        });

        commentsList.innerHTML = '';
        if (rootComments.length === 0) {
            commentsList.innerHTML = '<li>작성된 댓글이 없습니다.</li>';
            return;
        }
        rootComments.forEach(comment => {
            const li = createCommentElement(comment);
            commentsList.appendChild(li);
        });
    }

    function createCommentElement(comment) {
        const li = document.createElement('li');
        li.className = 'comment-item';
        li.id = `comment-${comment.id}`;
        const formatDate = (ts) => ts ? new Date(ts.seconds * 1000).toLocaleString('ko-KR') : '';

        li.innerHTML = `
            <div class="comment-header">
                <span class="comment-author">${comment.authorName}</span>
                <span class="comment-date">${formatDate(comment.createdAt)}</span>
            </div>
            <p class="comment-body">${comment.text.replace(/\n/g, '<br>')}</p>
            <div class="comment-actions">
                ${appState.currentUser ? `<button class="reply-btn" data-comment-id="${comment.id}">답글 달기</button>` : ''}
            </div>
        `;

        if (comment.children.length > 0) {
            const replyList = document.createElement('ul');
            replyList.className = 'reply-list';
            comment.children.forEach(reply => {
                replyList.appendChild(createCommentElement(reply));
            });
            li.appendChild(replyList);
        }
        
        li.querySelector('.reply-btn')?.addEventListener('click', showReplyForm);
        return li;
    }

    function showReplyForm(e) {
        const parentCommentId = e.target.dataset.commentId;
        const parentCommentItem = document.getElementById(`comment-${parentCommentId}`);

        const existingForm = parentCommentItem.querySelector('.reply-form-container');
        if (existingForm) {
            existingForm.remove();
            return;
        }
        
        const formContainer = document.createElement('div');
        formContainer.className = 'reply-form-container';
        formContainer.innerHTML = `
            <form class="comment-form reply-form">
                <textarea placeholder="답글을 입력하세요..." required></textarea>
                <button type="submit" class="write-btn">등록</button>
            </form>
        `;

        formContainer.querySelector('.reply-form').addEventListener('submit', (event) => {
            handleCommentSubmit(event, appState.currentPostId, parentCommentId);
        });

        parentCommentItem.appendChild(formContainer);
        formContainer.querySelector('textarea').focus();
    }
    
    // === 추천/비추천 기능 함수 ===

    async function setupVoteUI(postId) {
        const likeBtn = document.getElementById('like-btn');
        const dislikeBtn = document.getElementById('dislike-btn');
        if (!likeBtn || !dislikeBtn) return;

        likeBtn.addEventListener('click', () => handleVote(postId, 1));
        dislikeBtn.addEventListener('click', () => handleVote(postId, -1));

        const user = appState.currentUser;
        if (!user) return;

        const voteRef = doc(db, "posts", postId, "votes", user.uid);
        const snap = await getDoc(voteRef);
        if (snap.exists()) {
            const v = snap.data().value;
            if (v === 1) likeBtn.style.outline = "3px solid rgba(34,197,94,.4)";
            if (v === -1) dislikeBtn.style.outline = "3px solid rgba(239,68,68,.4)";
        }
    }

    async function handleVote(postId, value) {
        const user = appState.currentUser;
        if (!user) { alert("로그인이 필요합니다."); return; }

        const postRef = doc(db, "posts", postId);
        const voteRef = doc(db, "posts", postId, "votes", user.uid);

        try {
            await runTransaction(db, async (tx) => {
                const [postSnap, voteSnap] = await Promise.all([tx.get(postRef), tx.get(voteRef)]);
                if (!postSnap.exists()) throw new Error("게시물 없음");

                let likes = postSnap.data().likes || 0;
                let dislikes = postSnap.data().dislikes || 0;

                if (!voteSnap.exists()) {
                    if (value === 1) likes += 1;
                    else dislikes += 1;
                    tx.set(voteRef, { value, createdAt: serverTimestamp() });
                } else {
                    const prev = voteSnap.data().value;
                    if (prev === value) {
                        if (value === 1) likes -= 1;
                        else dislikes -= 1;
                        tx.delete(voteRef);
                    } else {
                        if (value === 1) { likes += 1; dislikes -= 1; }
                        else { dislikes += 1; likes -= 1; }
                        tx.update(voteRef, { value, createdAt: serverTimestamp() });
                    }
                }
                tx.update(postRef, { likes, dislikes });
            });

            const latest = (await getDoc(postRef)).data();
            document.getElementById('like-count').textContent = latest.likes || 0;
            document.getElementById('dislike-count').textContent = latest.dislikes || 0;

            const likeBtn = document.getElementById('like-btn');
            const dislikeBtn = document.getElementById('dislike-btn');
            likeBtn.style.outline = "";
            dislikeBtn.style.outline = "";

            const myVote = await getDoc(doc(db, "posts", postId, "votes", user.uid));
            if (myVote.exists()) {
                if (myVote.data().value === 1) likeBtn.style.outline = "3px solid rgba(34,197,94,.4)";
                if (myVote.data().value === -1) dislikeBtn.style.outline = "3px solid rgba(239,68,68,.4)";
            }
        } catch (e) {
            console.error(e);
            alert("투표 처리 중 오류가 발생했습니다.");
        }
    }
    
    // === 이벤트 핸들러 (사용자 행동 처리) ===

    async function handleSearchSubmit(e) {
        e.preventDefault();
        const queryText = document.getElementById('search-input').value.trim();
        if (!queryText) {
            alert("검색어를 입력해주세요.");
            return;
        }
        const results = await fetchSearchResults(queryText);
        renderSearchResultsView(results, queryText);
    }

    async function handlePostSubmit(e) {
        e.preventDefault();
        const title = document.getElementById('write-title').value;
        const content = document.getElementById('write-content').value;
        const user = appState.currentUser;

        if (!user) {
            alert("로그인이 필요합니다.");
            return;
        }

        try {
            const postsCol = collection(db, 'posts');
            await addDoc(postsCol, {
                title, content,
                authorId: user.uid,
                authorName: user.nickname,
                board: appState.currentBoard,
                createdAt: serverTimestamp(),
                views: 0, likes: 0, dislikes: 0, commentCount: 0,
            });
            
            const siteStatsDocRef = doc(db, 'siteStats', 'summary');
            await setDoc(siteStatsDocRef, { totalPosts: increment(1) }, { merge: true });

            alert("게시물이 등록되었습니다.");
            renderBoardView(appState.currentBoard, 1);
        } catch (error) {
            console.error("게시물 등록 오류: ", error);
            alert("게시물 등록에 실패했습니다.");
        }
    }

    async function handlePostUpdate(e) {
        e.preventDefault();
        const postId = e.target.dataset.postId;
        const newTitle = document.getElementById('edit-title').value;
        const newContent = document.getElementById('edit-content').value;

        if (!postId || !newTitle.trim() || !newContent.trim()) {
            alert("제목과 내용을 모두 입력해주세요.");
            return;
        }

        try {
            const postRef = doc(db, "posts", postId);
            await updateDoc(postRef, {
                title: newTitle,
                content: newContent
            });

            alert("게시물이 성공적으로 수정되었습니다.");
            renderPostView(appState.currentBoard, postId);
        } catch (error) {
            console.error("게시물 수정 오류:", error);
            alert("게시물 수정에 실패했습니다.");
        }
    }

    async function handlePostDelete(postId, boardId) {
        if (!confirm("정말로 게시물을 삭제하시겠습니까?\n삭제된 데이터는 복구할 수 없습니다.")) {
            return;
        }
        try {
            const postRef = doc(db, "posts", postId);
            await deleteDoc(postRef);
            alert("게시물이 삭제되었습니다.");
            renderBoardView(boardId, 1);
        } catch (error) {
            console.error("게시물 삭제 오류:", error);
            alert("게시물 삭제에 실패했습니다.");
        }
    }

    async function handleCommentSubmit(e, postId, parentId = null) {
        e.preventDefault();
        const user = appState.currentUser;
        if (!user) {
            alert("로그인이 필요합니다.");
            return;
        }

        const textarea = e.target.querySelector('textarea');
        const text = textarea.value.trim();
        if (!text) return;

        try {
            const commentsCol = collection(db, "posts", postId, "comments");
            const commentData = {
                text: text,
                authorId: user.uid,
                authorName: user.nickname,
                createdAt: serverTimestamp(),
            };
            if (parentId) {
                commentData.parentId = parentId;
            }
            await addDoc(commentsCol, commentData);

            const postRef = doc(db, "posts", postId);
            await updateDoc(postRef, { commentCount: increment(1) });
            
            textarea.value = '';
            const formContainer = e.target.closest('.reply-form-container');
            if(formContainer) formContainer.remove();
            renderComments(postId);
        } catch (error) {
            console.error("댓글 등록 오류: ", error);
            alert("댓글 등록에 실패했습니다.");
        }
    }
        
    // --- AUTHENTICATION LOGIC ---
    const userMenuContainer = document.getElementById('user-menu-container');
    const loginModal = document.getElementById('login-modal');
    const signupModal = document.getElementById('signup-modal');

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const userDocRef = doc(db, "users", user.uid);
            const userDoc = await getDoc(userDocRef);
            const nickname = userDoc.exists() ? userDoc.data().nickname : user.email.split('@')[0];
            
            appState.currentUser = { uid: user.uid, email: user.email, nickname: nickname };

            userMenuContainer.innerHTML = `
                <span>${nickname}님</span>
                <button id="logout-btn">로그아웃</button>
            `;
            document.getElementById('logout-btn').addEventListener('click', () => signOut(auth));
        } else {
            appState.currentUser = null;
            userMenuContainer.innerHTML = `
                <a href="#" id="login-btn">로그인</a>
                <a href="#" id="signup-btn">회원가입</a>
            `;
            document.getElementById('login-btn').addEventListener('click', (e) => { e.preventDefault(); loginModal.classList.add('show'); });
            document.getElementById('signup-btn').addEventListener('click', (e) => { e.preventDefault(); signupModal.classList.add('show'); });
        }
    });
    
    document.getElementById('signup-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const nickname = document.getElementById('signup-nickname').value;
        const email = document.getElementById('signup-email').value;
        const password = document.getElementById('signup-password').value;

        try {
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;
            await updateProfile(user, { displayName: nickname });
            await setDoc(doc(db, "users", user.uid), { nickname: nickname, email: email });
            alert('회원가입이 완료되었습니다! 이제 로그인해주세요.');
            signupModal.classList.remove('show');
        } catch (error) { alert(`회원가입 실패: ${error.message}`); }
    });

    document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        try {
            await signInWithEmailAndPassword(auth, email, password);
            loginModal.classList.remove('show');
        } catch (error) { alert(`로그인 실패: ${error.message}`); }
    });

    // --- GLOBAL EVENT LISTENERS ---
    document.querySelectorAll('.modal-overlay').forEach(modal => {
        modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.remove('show'); });
    });
    document.querySelectorAll('.modal-close-btn').forEach(btn => {
        btn.addEventListener('click', () => { btn.closest('.modal-overlay').classList.remove('show'); });
    });

    const sportsGalleryToggle = document.getElementById('sports-gallery-toggle');
    const sportsGalleryDropdown = document.getElementById('sports-gallery-dropdown');

    sportsGalleryToggle.addEventListener('click', (e) => {
        e.preventDefault();
        sportsGalleryDropdown.classList.toggle('show');
    });

    document.addEventListener('click', (e) => {
        if (!document.getElementById('sports-gallery-menu').contains(e.target)) {
            sportsGalleryDropdown.classList.remove('show');
        }
    });

    document.getElementById('app').addEventListener('click', (e) => {
        const navLink = e.target.closest('.nav-link');
        if (navLink && navLink.dataset.board) {
            e.preventDefault();
            renderBoardView(navLink.dataset.board, 1);
            sportsGalleryDropdown.classList.remove('show');
            return;
        }

        const postLink = e.target.closest('.post-link');
        if (postLink) {
            e.preventDefault();
            const postId = postLink.dataset.postId;
            const boardId = postLink.dataset.board;
            renderPostView(boardId, postId);
            return;
        }
    });

    document.getElementById('logo').addEventListener('click', renderMainView);
    document.getElementById('write-post-btn').addEventListener('click', renderWriteView);
    document.getElementById('search-form').addEventListener('submit', handleSearchSubmit);
    
    // Initial Render
    renderMainView();
</script>
</body>
</html>