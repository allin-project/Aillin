<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤í¬ì¸  ì»¤ë®¤ë‹ˆí‹° í”„ë¡œí† íƒ€ì…</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    
    <link rel="icon" href="logo.png" type="image/png">
    
    <style>
        /* CSSëŠ” ì´ì „ê³¼ ë™ì¼í•©ë‹ˆë‹¤. */
/* === ì „ì²´ ìŠ¤íƒ€ì¼ ê°œì„  === */

/* 1. êµ¬ê¸€ ì›¹í°íŠ¸ ì¶”ê°€ (Poppins: ì œëª©ìš©, Noto Sans KR: ë³¸ë¬¸ìš©) */
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Poppins:wght@600;700;800&display=swap');

/* 2. CSS ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•œ ì²´ê³„ì ì¸ ìƒ‰ìƒ ê´€ë¦¬ */
:root {
    --primary-color: #059669; /* ê¸°ì¡´ ë…¹ìƒ‰ */
    --primary-dark: #047857;
    --primary-light: #d1fae5;
    --secondary-color: #3b82f6; /* í™œê¸°ë¥¼ ë”í•´ì¤„ íŒŒë€ìƒ‰ */
    
    --text-color: #1e293b;
    --text-light: #475569;
    --border-color: #e2e8f0;
    --background-light: #f1f5f9;
    --background-white: #ffffff;

    --danger-color: #ef4444;

    --font-heading: 'Poppins', 'Noto Sans KR', sans-serif;
    --font-body: 'Noto Sans KR', sans-serif;
    
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    
    --border-radius: 0.75rem; /* ì „ë°˜ì ì¸ ë‘¥ê·¼ ëª¨ì„œë¦¬ ê°’ ì¦ê°€ */
}

/* 3. ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë° ì „í™˜ íš¨ê³¼ ì„¤ì • */
* {
    transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
}

body { 
    font-family: var(--font-body); 
    background-color: var(--background-light); 
    color: var(--text-color); 
    display: flex; 
    flex-direction: column; 
    min-height: 100vh; 
    margin: 0; 
}
.container { width: 100%; max-width: 1280px; margin-left: auto; margin-right: auto; padding: 1rem; flex-grow: 1; }
.view { display: none; }
.view.active { display: block; animation: fadeIn 0.5s ease-in-out; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

/* === í—¤ë” ë° ë„¤ë¹„ê²Œì´ì…˜ === */
.header { 
    display: flex; 
    flex-direction: column; 
    justify-content: space-between; 
    align-items: center; 
    margin-bottom: 2rem; 
    padding-bottom: 1.5rem; 
    border-bottom: 1px solid var(--border-color); 
}
.header h1 { 
    font-family: var(--font-heading);
    font-size: 2.25rem; /* ì œëª© í°íŠ¸ í¬ê¸° ì¦ê°€ */
    font-weight: 800; 
    color: var(--text-color); 
    cursor: pointer; 
    margin-bottom: 1rem; 
}
.search-area {
    display: flex; /* flexbox ë ˆì´ì•„ì›ƒ ì ìš© */
    align-items: center;
    width: 320px; /* ê²€ìƒ‰ì°½ì˜ ì „ì²´ ë„ˆë¹„ë¥¼ ì§€ì • (ì¡°ì ˆ ê°€ëŠ¥) */
}

.search-area input { 
    padding: 0.75rem 1rem; 
    border: 1px solid var(--border-color); 
    border-radius: var(--border-radius); 
    /* width: 100%; ì‚­ì œ */
    flex-grow: 1; /* ë‚¨ëŠ” ê³µê°„ì„ ëª¨ë‘ ì°¨ì§€í•˜ë„ë¡ ì„¤ì • */
    border-right: none; /* ë²„íŠ¼ê³¼ ì´ì–´ì§€ë„ë¡ ì˜¤ë¥¸ìª½ í…Œë‘ë¦¬ ì œê±° */
    border-top-right-radius: 0; /* ì˜¤ë¥¸ìª½ ëª¨ì„œë¦¬ ê° ì œê±° */
    border-bottom-right-radius: 0;
}
.search-area input:focus { 
    outline: none; 
    box-shadow: 0 0 0 3px var(--primary-light); 
    border-color: var(--primary-color);
}
.search-area button { 
    padding: 0.75rem 1rem; 
    background-color: var(--primary-color); /* í…Œë§ˆ ìƒ‰ìƒìœ¼ë¡œ ë³€ê²½ */
    color: white; 
    border: 1px solid var(--primary-color); /* í…Œë‘ë¦¬ ì¶”ê°€ */
    border-radius: var(--border-radius); 
    cursor: pointer; 
    font-weight: 600;
    flex-shrink: 0; /* ë²„íŠ¼ í¬ê¸°ê°€ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ ì„¤ì • */
    border-top-left-radius: 0; /* ì™¼ìª½ ëª¨ì„œë¦¬ ê° ì œê±° */
    border-bottom-left-radius: 0;
}
.search-area button:hover { 
    background-color: var(--primary-dark); /* í˜¸ë²„ ìƒ‰ìƒ ë³€ê²½ */
    border-color: var(--primary-dark);
}
.user-menu { display: flex; gap: 1rem; margin-top: 1rem; align-items: center; }
.user-menu span { font-weight: 600; }
.user-menu a, .user-menu button { 
    color: var(--text-light); 
    text-decoration: none; 
    background: none; border: none; 
    cursor: pointer; font-size: 1em; 
    font-family: inherit; font-weight: 600; padding: 0.5rem;
    border-radius: 0.5rem;
}
.user-menu a:hover, .user-menu button:hover { color: var(--primary-color); background-color: var(--primary-light); }

.main-nav { 
    background-color: var(--background-white); 
    border-radius: var(--border-radius); 
    box-shadow: var(--shadow-md); 
    padding: 0.5rem; 
    margin-bottom: 2.5rem; 
}
.main-nav ul { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 0.5rem; font-weight: 700; list-style: none; padding: 0; margin: 0; }
.nav-link { 
    padding: 0.75rem 1.25rem; /* ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ íŒ¨ë”© ì¡°ì • */
    display: block; 
    color: var(--text-light); 
    border-radius: 0.5rem; 
    text-decoration: none; 
    cursor: pointer; 
    position: relative;
}
.nav-link:hover { 
    color: var(--primary-dark); 
    background-color: var(--background-light); 
}
.nav-link.active { 
    color: var(--primary-color); 
    font-weight: 700; 
}
/* í™œì„± ë§í¬ ë°‘ì¤„ íš¨ê³¼ ì¶”ê°€ */
.nav-link.active::after {
    content: '';
    position: absolute;
    bottom: 5px;
    left: 1.25rem;
    right: 1.25rem;
    height: 3px;
    background-color: var(--primary-color);
    border-radius: 2px;
}
.sports-gallery-menu { position: relative; }
.sports-gallery-toggle { display: flex; align-items: center; }
.sports-gallery-toggle svg { width: 1rem; height: 1rem; margin-left: 0.25rem; color: #64748b; }
.sports-gallery-dropdown { 
    position: absolute; display: none; 
    margin-top: 0.75rem; width: 12rem; 
    background-color: var(--background-white); 
    border-radius: var(--border-radius); 
    box-shadow: var(--shadow-lg); z-index: 10; 
    border: 1px solid var(--border-color); 
    padding: 0.5rem; /* ë“œë¡­ë‹¤ìš´ ë©”ë‰´ íŒ¨ë”© ì¶”ê°€ */
    overflow: hidden; /* ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•´ */
}
.sports-gallery-dropdown.show { display: block; animation: dropdown-show 0.2s ease-out; }
@keyframes dropdown-show { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
.sports-gallery-dropdown .nav-link { font-size: 0.9rem; font-weight: 500; }
.sports-gallery-dropdown .nav-link.active::after { display: none; } /* ë“œë¡­ë‹¤ìš´ ë‚´ë¶€ëŠ” ë°‘ì¤„ ì œê±° */
.sports-gallery-dropdown .nav-link:hover { color: var(--primary-color); }


/* === ë©”ì¸ ì½˜í…ì¸  ì„¹ì…˜ === */
main section { margin-bottom: 3.5rem; }
main h2 { 
    font-family: var(--font-heading);
    font-size: 1.875rem; 
    font-weight: 700; 
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--border-color);
}

/* === ì¹´ë“œ ë””ìì¸ ê°œì„  (ê·¸ë¦¼ì, í˜¸ë²„ íš¨ê³¼) === */
.match-schedule { display: grid; gap: 1.5rem; }
.match-card { 
    background-color: var(--background-white); 
    padding: 1.5rem; 
    border-radius: var(--border-radius); 
    box-shadow: var(--shadow-md);
    border: none;
    cursor: pointer;
}
.match-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}
.match-card-header { 
    display: flex; justify-content: space-between; 
    align-items: center; font-size: 0.875rem; 
    color: var(--text-light); margin-bottom: 1rem; 
    font-weight: 600;
}
.match-card-header .status { font-weight: 700; padding: 0.25rem 0.75rem; border-radius: 999px; color: white; }
.match-card-header .status.live { background-color: var(--danger-color); }
.match-card-header .status.finished { background-color: var(--text-light); }
.match-card-body { display: flex; align-items: center; justify-content: space-between; }
.match-card-body .team { font-weight: 700; font-size: 1.25rem; flex: 1; text-align: center; }
.match-card-body .score { font-family: var(--font-heading); font-weight: 800; font-size: 2rem; color: var(--primary-color); margin: 0 1rem; }

/* === ì¸ê¸°ê¸€ ëª©ë¡ ê°œì„  === */
.popular-posts { 
    background-color: var(--background-white); 
    padding: 1.5rem; 
    border-radius: var(--border-radius); 
    box-shadow: var(--shadow-md); 
}
.popular-posts ul { list-style: none; padding: 0; margin: 0; }
.popular-posts li { 
    padding: 0.75rem 0.25rem; 
    border-bottom: 1px solid var(--background-light); 
    font-size: 1rem;
}
.popular-posts li:last-child { border-bottom: none; }
.popular-posts a { text-decoration: none; color: inherit; display: block; }
.popular-posts a:hover { color: var(--primary-color); transform: translateX(4px); }
.popular-posts .board-name { font-weight: 700; color: var(--secondary-color); }
.popular-posts .comment-count { font-weight: 600; color: var(--danger-color); margin-left: 0.25rem; font-size: 0.9em;}


/* === ê²Œì‹œíŒ ëª©ë¡ ê°œì„  === */
.board-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
.write-btn { 
    background-color: var(--primary-color); 
    color: white; 
    padding: 0.75rem 1.5rem; 
    border-radius: 0.5rem; 
    font-weight: 700; 
    border: none; 
    cursor: pointer;
    box-shadow: var(--shadow-sm);
}
.write-btn:hover { background-color: var(--primary-dark); box-shadow: var(--shadow-md); }
.table-container { 
    background-color: var(--background-white); 
    border-radius: var(--border-radius); 
    box-shadow: var(--shadow-md); 
    overflow: hidden; /* radius ì ìš©ì„ ìœ„í•´ */
}
.post-table { width: 100%; font-size: 0.9rem; text-align: center; border-collapse: collapse; }
.post-table thead { 
    font-size: 0.8rem; 
    color: var(--text-color); 
    text-transform: uppercase; 
    background-color: var(--background-light); 
    font-family: var(--font-heading);
}
.post-table th, .post-table td { padding: 1rem 1.5rem; }
.post-table th:nth-child(2), .post-table td:nth-child(2) { text-align: left; } /* ì œëª©ì€ ì™¼ìª½ ì •ë ¬ */
.post-table tbody tr { border-bottom: 1px solid var(--background-light); }
.post-table tbody tr:last-child { border-bottom: none; }
.post-table tbody tr:hover { background-color: var(--primary-light); cursor: pointer; }
.pagination { display: flex; justify-content: center; margin-top: 1.5rem; }
.pagination button { 
    padding: 0.5rem 1rem; 
    margin: 0 0.25rem; 
    border-radius: 0.5rem; 
    border: 1px solid var(--border-color); 
    background-color: var(--background-white); 
    color: var(--text-light); 
    cursor: pointer;
    font-weight: 600;
}
.pagination button:hover { background-color: var(--background-light); border-color: var(--primary-color); }
.pagination button.active { 
    background-color: var(--primary-color); 
    color: white; 
    border-color: var(--primary-color); 
    box-shadow: var(--shadow-md);
}

/* === ëª¨ë‹¬ ê°œì„  === */
.modal-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.6); display: none; align-items: center; justify-content: center; z-index: 50; backdrop-filter: blur(4px); }
.modal-overlay.show { display: flex; animation: fadeIn 0.3s; }
.modal-box { 
    background-color: var(--background-white); 
    padding: 2rem; 
    border-radius: var(--border-radius); 
    box-shadow: var(--shadow-lg); 
    width: 100%; max-width: 420px;
    animation: slideUp 0.4s ease-out;
}
@keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
.modal-header h2 { font-size: 1.5rem; font-weight: 700; font-family: var(--font-heading); }
.modal-close-btn { font-size: 2rem; color: #9ca3af; cursor: pointer; border: none; background: none; line-height: 1; }
.modal-close-btn:hover { color: var(--text-color); }
.modal-body .form-group { margin-bottom: 1.25rem; }
.modal-body label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
.modal-body input { width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 0.5rem; box-sizing: border-box; }
.modal-body input:focus { border-color: var(--primary-color); outline: none; box-shadow: 0 0 0 3px var(--primary-light); }
.modal-body button { 
    width: 100%; padding: 0.875rem; 
    border-radius: 0.5rem; 
    background-color: var(--primary-color); 
    color: white; 
    font-weight: 700; font-size: 1rem;
    border: none; cursor: pointer; 
}
.modal-body button:hover { background-color: var(--primary-dark); }

/* === í‘¸í„° ê°œì„  === */
.footer { background-color: #0f172a; color: #cbd5e1; margin-top: 3rem; }
.footer .container { padding: 2.5rem 1rem; text-align: center; font-size: 0.875rem; }
.footer p { margin-bottom: 0.5rem; }
.footer .links { display: flex; justify-content: center; gap: 1.5rem; margin-bottom: 1rem; }
.footer a { color: #cbd5e1; text-decoration: none; }
.footer a:hover { color: white; text-decoration: underline; }
.footer .copyright { color: #64748b; font-size: 0.8rem; }

/* === ê¸€ì“°ê¸°/ê²Œì‹œë¬¼ ë³´ê¸° í™”ë©´ ê°œì„  === */
#write-form, #post-content-view { 
    padding: 2.5rem; 
    background-color: var(--background-white); 
    border-radius: var(--border-radius); 
    box-shadow: var(--shadow-md); 
}
#write-form input, #write-form textarea { 
    width: 100%; padding: 0.75rem; 
    border: 1px solid var(--border-color); 
    border-radius: 0.5rem; 
    box-sizing: border-box; 
    margin-bottom: 1.5rem; 
}
#write-form input:focus, #write-form textarea:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 3px var(--primary-light);
}
#write-form textarea { min-height: 300px; resize: vertical; }
#write-form .form-actions { text-align: right; display: flex; gap: 1rem; justify-content: flex-end; }

#post-content-view h1 { font-family: var(--font-heading); font-size: 2.5rem; margin-bottom: 1rem; }
#post-meta { color: var(--text-light); margin-bottom: 2rem; }
#post-body { 
    line-height: 1.8; 
    font-size: 1.1rem; /* ë³¸ë¬¸ ê°€ë…ì„± í–¥ìƒ */
    min-height: 200px; 
    border-top: 1px solid var(--border-color); 
    border-bottom: 1px solid var(--border-color); 
    padding: 2.5rem 0; 
    margin-bottom: 2rem;
}

/* === ëŒ“ê¸€ ê¸°ëŠ¥ CSS === */
#comments-section { margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid var(--border-color); }
#comments-section h3 { font-size: 1.5rem; margin-bottom: 1.5rem; font-family: var(--font-heading); }
#comments-list { list-style: none; padding: 0; }
.comment-item { padding: 1.25rem; border-bottom: 1px solid var(--background-light); background-color: transparent; border-radius: 0.5rem; }
.comment-item:last-child { border-bottom: none; }
.comment-item:hover { background-color: var(--background-light); }
.comment-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem; }
.comment-author { font-weight: 700; }
.comment-date { font-size: 0.875rem; color: var(--text-light); }
.comment-body { margin-bottom: 0.75rem; color: #334155; }
.comment-actions button { background: none; border: none; color: var(--text-light); font-size: 0.875rem; cursor: pointer; padding: 0.25rem; font-weight: 600; }
.comment-actions button:hover { color: var(--primary-color); }

.reply-list { 
    list-style: none; 
    padding-left: 1.5rem; 
    border-left: 3px solid var(--border-color); 
    margin-top: 1rem; 
    margin-left: 1rem;
}

.comment-form { display: flex; gap: 0.75rem; margin-top: 1.5rem; align-items: flex-start; }
.comment-form textarea { 
    flex-grow: 1; border: 1px solid var(--border-color); 
    border-radius: 0.5rem; padding: 0.75rem; 
    resize: vertical; min-height: 48px; 
    background-color: var(--background-white);
}
.comment-form textarea:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 3px var(--primary-light);
}
.comment-form button { flex-shrink: 0; align-self: flex-end; }
.reply-form-container { padding-left: 0; margin-top: 1rem; }

/* === ë°˜ì‘í˜• ì›¹ ë””ìì¸ === */
@media (min-width: 640px) { 
    .header { flex-direction: row; } 
    .header h1 { margin-bottom: 0; } 
    .user-menu { margin-top: 0; } 
    .main-nav ul { justify-content: flex-start; flex-wrap: nowrap; } 
    .search-area { width: auto; }
}
@media (min-width: 768px) { 
    .match-schedule { grid-template-columns: repeat(2, minmax(0, 1fr)); } 
    .photo-gallery { grid-template-columns: repeat(4, minmax(0, 1fr)); } 
}
@media (min-width: 1024px) { 
    .match-schedule { grid-template-columns: repeat(3, minmax(0, 1fr)); } 
}


/* === ì¹´ë“œí˜• ê²Œì‹œíŒ ëª©ë¡ ìŠ¤íƒ€ì¼ === */
.post-list-cards {
    display: grid;
    gap: 1.5rem;
}
.post-card {
    background-color: var(--background-white);
    padding: 1.5rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-md);
    cursor: pointer;
    border-left: 5px solid transparent;
    transition: transform 0.2s, box-shadow 0.2s, border-left-color 0.2s;
}
.post-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
    border-left-color: var(--primary-color);
}
.post-card-title {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}
.post-card-meta {
    font-size: 0.875rem;
    color: var(--text-light);
    margin-bottom: 1rem;
}
.post-card-stats {
    display: flex;
    gap: 1rem;
    font-size: 0.9rem;
    color: var(--text-light);
}
/* ê¸°ì¡´ CSSëŠ” ìœ„ì—ì„œ ëª¨ë‘ ë®ì–´ì¼ìŠµë‹ˆë‹¤. */
/* ì¶”ì²œ/ë¹„ì¶”ì²œ ë²„íŠ¼ì€ JSì—ì„œ styleì„ ì§ì ‘ ì œì–´í•˜ë¯€ë¡œ ê·¸ëŒ€ë¡œ ë‘¡ë‹ˆë‹¤. */

        /* === ëŒ“ê¸€ ê¸°ëŠ¥ CSS ì¶”ê°€ END === */
   </style>
</head>
<body>

    <div id="app" class="container">
        
<header class="header">
    <h1 id="logo">ì˜¬ ì¸ äºº</h1>

    <form id="search-form" class="search-area">
        <input type="text" id="search-input" placeholder="ê²Œì‹œë¬¼ ì œëª© ê²€ìƒ‰..." required>
        <button type="submit">ê²€ìƒ‰</button>
    </form>

    <div id="user-menu-container" class="user-menu">
        </div>
</header>

        <nav class="main-nav">
            <ul>
                <li><a href="#" class="nav-link" data-board="freeboard">ììœ ê²Œì‹œíŒ</a></li>
                <li class="sports-gallery-menu" id="sports-gallery-menu">
                    <a href="#" id="sports-gallery-toggle" class="nav-link sports-gallery-toggle" data-board-group="sports">
                        ìŠ¤í¬ì¸ ê°¤ëŸ¬ë¦¬
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </a>
                    <div id="sports-gallery-dropdown" class="sports-gallery-dropdown">
                        <a href="#" class="nav-link" data-board="soccer">ì¶•êµ¬</a>
                        <a href="#" class="nav-link" data-board="baseball">ì•¼êµ¬</a>
                        <a href="#" class="nav-link" data-board="basketball">ë†êµ¬</a>
                        <a href="#" class="nav-link" data-board="esports">eìŠ¤í¬ì¸ </a>
                    </div>
                </li>
                <li><a href="#" class="nav-link" data-main-nav-link="true" data-board="announcements">ê³µì§€ì‚¬í•­</a></li>
            </ul>
        </nav>

<main>
    <div id="main-view" class="view active">
        <section>
            <h2>ì£¼ìš” ê²½ê¸°</h2>
            <div id="match-schedule" class="match-schedule"></div>
        </section>
        <section>
            <h2>ì»¤ë®¤ë‹ˆí‹° ì¸ê¸°ê¸€</h2>
            <div id="popular-posts" class="popular-posts"></div>
        </section>
        <section>
    <h2>ğŸ¤– AI ìŠ¹ë¶€ ì˜ˆì¸¡</h2>
    <div id="prediction-ui" style="background-color: white; padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);">
        <div style="display: flex; gap: 1rem; margin-bottom: 1rem; align-items: center; flex-wrap: wrap;">
            <select id="ai-sport-select" style="padding: 0.5rem; border: 1px solid #cbd5e1; border-radius: 0.5rem;">
                <option value="soccer">ì¶•êµ¬</option>
                <option value="baseball">ì•¼êµ¬</option>
                <option value="basketball">ë†êµ¬</option>
                <option value="esports">eìŠ¤í¬ì¸ </option>
            </select>
            <input type="text" id="ai-team-a" placeholder="íŒ€ A ì´ë¦„" style="flex-grow: 1; padding: 0.5rem; border: 1px solid #cbd5e1; border-radius: 0.5rem;">
            <span style="font-weight: 700;">VS</span>
            <input type="text" id="ai-team-b" placeholder="íŒ€ B ì´ë¦„" style="flex-grow: 1; padding: 0.5rem; border: 1px solid #cbd5e1; border-radius: 0.5rem;">
            <button id="ai-predict-btn" class="write-btn">ì˜ˆì¸¡í•˜ê¸°</button>
        </div>
        <div id="ai-prediction-result" style="margin-top: 1rem; padding: 1rem; border: 1px dashed #e2e8f0; border-radius: 0.5rem; min-height: 50px; white-space: pre-wrap; line-height: 1.6;">
            ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
        </div>
    </div>
</section>
    </div>

<div id="board-view" class="view">
    <div class="board-header">
        <h2 id="board-title"></h2>
        <button id="write-post-btn" class="write-btn">ê¸€ì“°ê¸°</button>
    </div>
    <div id="post-list-cards" class="post-list-cards">
        </div>
    <div id="pagination" class="pagination"></div>
</div>

    <div id="post-view" class="view">
        </div>

    <div id="write-view" class="view">
        </div>

    <div id="search-results-view" class="view">
        </div>
</main>
    </div>
    
    <div id="login-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header"><h2>ë¡œê·¸ì¸</h2><button class="modal-close-btn">&times;</button></div>
            <div class="modal-body">
                <form id="login-form">
                    <div class="form-group"><label for="login-email">ì´ë©”ì¼</label><input type="email" id="login-email" required></div>
                    <div class="form-group"><label for="login-password">ë¹„ë°€ë²ˆí˜¸</label><input type="password" id="login-password" required></div>
                    <button type="submit">ë¡œê·¸ì¸</button>
                </form>
            </div>
        </div>
    </div>
    <div id="signup-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header"><h2>íšŒì›ê°€ì…</h2><button class="modal-close-btn">&times;</button></div>
            <div class="modal-body">
               <form id="signup-form">
                    <div class="form-group"><label for="signup-nickname">ë‹‰ë„¤ì„</label><input type="text" id="signup-nickname" required></div>
                    <div class="form-group"><label for="signup-email">ì´ë©”ì¼</label><input type="email" id="signup-email" required></div>
                    <div class="form-group"><label for="signup-password">ë¹„ë°€ë²ˆí˜¸</label><input type="password" id="signup-password" minlength="6" required></div>
                    <button type="submit">ê°€ì…í•˜ê¸°</button>
               </form>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p style="font-weight: 700;">ì˜¬ ì¸ äºº</p>
            <div class="links">
                <a href="#">íšŒì‚¬ì†Œê°œ</a><a href="#">ì´ìš©ì•½ê´€</a><a href="#">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a><a href="#">ê³ ê°ì„¼í„°</a>
            </div>
            <p class="copyright">Â© 2025 All In äºº. All Rights Reserved.</p>
        </div>
    </footer>

<script type="module">
    // Firebase SDK IMPORTS
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { 
        getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, 
        onAuthStateChanged, signOut, updateProfile
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { 
        getFirestore, doc, setDoc, getDoc, getDocs, collection, 
        query, where, orderBy, limit, addDoc, serverTimestamp, increment, updateDoc,
        runTransaction, deleteDoc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // FIREBASE CONFIG
    const firebaseConfig = {
        apiKey: "AIzaSyAUuUlYHUwOuwnm_hsIsd7XHlj5voCecQk",
        authDomain: "community-d18d4.firebaseapp.com",
        projectId: "community-d18d4",
        storageBucket: "community-d18d4.appspot.com",
        messagingSenderId: "497702481194",
        appId: "1:497702481194:web:a826db91628adc24718253"
    };

    // FIREBASE INITIALIZATION
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // APP STATE
    const appState = {
        currentUser: null,
        currentView: 'main-view',
        currentBoard: null,
        currentPostId: null,
        currentPage: 1,
        postsPerPage: 10,
    };
    
    const boardNames = {
        freeboard: 'ììœ ê²Œì‹œíŒ', announcements: 'ê³µì§€ì‚¬í•­', soccer: 'ì¶•êµ¬', 
        baseball: 'ì•¼êµ¬', basketball: 'ë†êµ¬', esports: 'eìŠ¤í¬ì¸ ',
    };

    // === Firestore ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ ===
    
    async function fetchMatches() {
        const matchesCol = collection(db, 'matches');
        const q = query(matchesCol, orderBy('time', 'desc'), limit(6));
        const snapshot = await getDocs(q);
        return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    }
    
    async function fetchPopularPosts() {
        const postsCol = collection(db, 'posts');
        const q = query(postsCol, orderBy('likes', 'desc'), limit(5));
        const snapshot = await getDocs(q);
        return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    }
    
    async function fetchPhotos() {
        return [
            { id: 1, src: 'https://placehold.co/600x400/10b981/ffffff?text=í™˜í˜¸í•˜ëŠ”+ì„ ìˆ˜ë“¤', caption: 'ê·¹ì ì¸ ì—­ì „ê³¨!', board: 'soccer' },
            { id: 2, src: 'https://placehold.co/600x400/ef4444/ffffff?text=í™ˆëŸ°+ì„¸ë¦¬ë¨¸ë‹ˆ', caption: 'ì§œë¦¿í•œ ëë‚´ê¸° í™ˆëŸ°', board: 'baseball' },
            { id: 3, src: 'https://placehold.co/600x400/8b5cf6/ffffff?text=ìŠ¬ë¨ë©í¬', caption: 'ì—„ì²­ë‚œ ë©í¬ìŠ›', board: 'basketball' },
            { id: 4, src: 'https://placehold.co/600x400/3b82f6/ffffff?text=ìš°ìŠ¹+íŠ¸ë¡œí”¼', caption: 'ê°ê²©ì˜ ìš°ìŠ¹ ìˆœê°„', board: 'esports' },
        ];
    }

    async function fetchPostsForBoard(boardId, page = 1) {
        const postsCol = collection(db, 'posts');
        const q = query(postsCol, where("board", "==", boardId), orderBy("createdAt", "desc"), limit(appState.postsPerPage));
        const snapshot = await getDocs(q);
        return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    }

    async function fetchSearchResults(queryText) {
        const postsRef = collection(db, "posts");
        const q = query(postsRef, 
            where("title", ">=", queryText),
            where("title", "<=", queryText + '\uf8ff'),
            orderBy("title"),
            limit(20)
        );
        const snapshot = await getDocs(q);
        return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    }

    // === UI ë Œë”ë§ í•¨ìˆ˜ ===

    function showView(viewId) {
        document.querySelectorAll('.view').forEach(view => view.classList.remove('active'));
        const viewToShow = document.getElementById(viewId);
        if(viewToShow) {
            viewToShow.classList.add('active');
            appState.currentView = viewId;
            window.scrollTo(0, 0);
        }
    }

    async function renderMainView() {
        showView('main-view');
        
        const matches = await fetchMatches();
        const matchContainer = document.getElementById('match-schedule');
        matchContainer.innerHTML = matches.map(match => `
            <div class="match-card">
                <div class="match-card-header">
                    <span>${boardNames[match.sport] || match.sport}</span>
                    <span class="status ${match.time === 'ì¢…ë£Œ' ? 'finished' : 'live'}">${match.time}</span>
                </div>
                <div class="match-card-body">
                    <span class="team">${match.teamA}</span>
                    <span class="score">${match.scoreA} : ${match.scoreB}</span>
                    <span class="team">${match.teamB}</span>
                </div>
            </div>
        `).join('') || "<p>ë“±ë¡ëœ ê²½ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";

        const popularPosts = await fetchPopularPosts();
        const popularPostsContainer = document.getElementById('popular-posts');
        popularPostsContainer.innerHTML = `<ul>${popularPosts.map(post => `
            <li>
                <a href="#" class="post-link" data-post-id="${post.id}" data-board="${post.board}">
                    <span class="board-name">[${boardNames[post.board]}]</span> ${post.title} 
                    <span class="comment-count">[${post.commentCount || 0}]</span>
                </a>
            </li>
        `).join('')}</ul>` || "<p>ì¸ê¸°ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>";

        const photos = await fetchPhotos();
        document.getElementById('photo-gallery').innerHTML = photos.map(photo => `
            <div class="photo-card">
                <img src="${photo.src}" alt="${photo.caption}">
                <div class="caption"><p>${photo.caption}</p></div>
            </div>
        `).join('');
    }



    // === AI ìŠ¹ë¶€ ì˜ˆì¸¡ ê¸°ëŠ¥ ì¶”ê°€ START ===

async function handlePrediction(e) {
    const sport = document.getElementById('ai-sport-select').value;
    const teamA = document.getElementById('ai-team-a').value.trim();
    const teamB = document.getElementById('ai-team-b').value.trim();
    const resultDiv = document.getElementById('ai-prediction-result');
    const predictBtn = document.getElementById('ai-predict-btn');

    if (!teamA || !teamB) {
        alert('íŒ€ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        return;
    }

    // ë¡œë”© ìƒíƒœ í‘œì‹œ
    resultDiv.textContent = 'ğŸ§  AIê°€ ì—´ì‹¬íˆ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...';
    predictBtn.disabled = true;
    predictBtn.textContent = 'ë¶„ì„ì¤‘...';

    try {
        const response = await fetch('/api/predict', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ sport, teamA, teamB }),
        });

        const data = await response.json();

        if (!response.ok) {
            throw new Error(data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }

        resultDiv.textContent = data.prediction;

    } catch (error) {
        console.error('Prediction Error:', error);
        resultDiv.textContent = `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
    } finally {
        // ë¡œë”© ìƒíƒœ í•´ì œ
        predictBtn.disabled = false;
        predictBtn.textContent = 'ì˜ˆì¸¡í•˜ê¸°';
    }
}

// ì˜ˆì¸¡ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
// ì´ ì½”ë“œëŠ” renderMainView í•¨ìˆ˜ê°€ í˜¸ì¶œëœ í›„ì— ì‹¤í–‰ë˜ì–´ì•¼ í•˜ë¯€ë¡œ,
// ì´ˆê¸° ë Œë”ë§ í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ í•œ ë²ˆë§Œ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.
document.addEventListener('DOMContentLoaded', () => {
    // ë²„íŠ¼ì´ ë‚˜ì¤‘ì— ìƒì„±ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìƒìœ„ ìš”ì†Œì— ì´ë²¤íŠ¸ ìœ„ì„ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
    document.body.addEventListener('click', function(event) {
        if (event.target && event.target.id === 'ai-predict-btn') {
            handlePrediction();
        }
    });
});


    
    async function renderBoardView(boardId, page) {
        appState.currentBoard = boardId;
        appState.currentPage = page;
        showView('board-view');
        document.getElementById('board-title').textContent = boardNames[boardId] + " ê²Œì‹œíŒ";
        
        const postListContainer = document.getElementById('post-list-cards');
        const formatDate = (timestamp) => timestamp ? new Date(timestamp.seconds * 1000).toLocaleDateString('ko-KR') : 'ë°©ê¸ˆ';
        const posts = await fetchPostsForBoard(boardId, page);

        if (posts.length === 0) {
            postListContainer.innerHTML = '<p style="text-align:center; padding: 2rem 0;">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        postListContainer.innerHTML = posts.map(post => `
            <div class="post-card post-link" data-post-id="${post.id}" data-board="${post.board}">
                <h3 class="post-card-title">${post.title}</h3>
                <div class="post-card-meta">
                    <span>${post.authorName}</span> ãƒ» <span>${formatDate(post.createdAt)}</span>
                </div>
                <div class="post-card-stats">
                    <span>ğŸ‘ï¸ ${post.views || 0}</span>
                    <span>ğŸ‘ ${post.likes || 0}</span>
                    <span>ğŸ’¬ ${post.commentCount || 0}</span>
                </div>
            </div>
        `).join('');
    }

    function renderWriteView() {
        const boardId = appState.currentBoard;
        if (!appState.currentUser) {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            return;
        }
        showView('write-view');
        const writeView = document.getElementById('write-view');
        writeView.innerHTML = `
            <h2>${boardNames[boardId]} ê¸€ì“°ê¸°</h2>
            <form id="write-form">
                <input type="text" id="write-title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                <textarea id="write-content" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
                <div class="form-actions">
                    <button type="button" id="cancel-write-btn" class="write-btn" style="background-color:#64748b;">ì·¨ì†Œ</button>
                    <button type="submit" class="write-btn">ë“±ë¡</button>
                </div>
            </form>
        `;
        document.getElementById('write-form').addEventListener('submit', handlePostSubmit);
        document.getElementById('cancel-write-btn').addEventListener('click', () => renderBoardView(appState.currentBoard, 1));
    }

    async function renderEditView(postId) {
        showView('write-view');
        const writeView = document.getElementById('write-view');
        
        const postRef = doc(db, "posts", postId);
        const postSnap = await getDoc(postRef);
        if (!postSnap.exists()) {
            alert("ìˆ˜ì •í•  ê²Œì‹œë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            renderBoardView(appState.currentBoard, 1);
            return;
        }
        const post = postSnap.data();

        writeView.innerHTML = `
            <h2>ê²Œì‹œë¬¼ ìˆ˜ì •</h2>
            <form id="edit-form" data-post-id="${postId}">
                <input type="text" id="edit-title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" value="${post.title}" required>
                <textarea id="edit-content" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required>${post.content}</textarea>
                <div class="form-actions">
                    <button type="button" id="cancel-edit-btn" class="write-btn" style="background-color:#64748b;">ì·¨ì†Œ</button>
                    <button type="submit" class="write-btn">ìˆ˜ì •í•˜ê¸°</button>
                </div>
            </form>
        `;
        document.getElementById('edit-form').addEventListener('submit', handlePostUpdate);
        document.getElementById('cancel-edit-btn').addEventListener('click', () => renderPostView(post.board, postId));
    }

    async function renderPostView(boardId, postId) {
        showView('post-view');
        appState.currentPostId = postId;
        const postRef = doc(db, "posts", postId);
        
        const postSnapForViewCount = await getDoc(postRef);
        if (postSnapForViewCount.exists() && postSnapForViewCount.data().authorId !== appState.currentUser?.uid) {
            await updateDoc(postRef, { views: increment(1) });
        }
        
        const postSnap = await getDoc(postRef);

        if (postSnap.exists()) {
            const post = postSnap.data();
            const postView = document.getElementById('post-view');
            const formatDate = (timestamp) => timestamp ? new Date(timestamp.seconds * 1000).toLocaleString('ko-KR') : '';
            
            const isAuthor = appState.currentUser && appState.currentUser.uid === post.authorId;
            const authorButtons = `
                <button id="edit-post-btn" class="write-btn" style="background-color: var(--secondary-color);">ìˆ˜ì •</button>
                <button id="delete-post-btn" class="write-btn" style="background-color: var(--danger-color);">ì‚­ì œ</button>
            `;

            postView.innerHTML = `
                <div id="post-content-view">
                    <h1>${post.title}</h1>
                    <div id="post-meta">
                        <span>ì‘ì„±ì: ${post.authorName}</span> | 
                        <span>ì‘ì„±ì¼: ${formatDate(post.createdAt)}</span> |
                        <span>ì¡°íšŒ: ${post.views || 0}</span>
                    </div>
                    <div id="post-body">${post.content.replace(/\n/g, '<br>')}</div>
                    <div id="vote-bar" style="display:flex; gap:.5rem; align-items:center; margin:1rem 0;">
                        <button id="like-btn" class="write-btn" style="background:#16a34a;">
                            ğŸ‘ ì¶”ì²œ <span id="like-count">${post.likes || 0}</span>
                        </button>
                        <button id="dislike-btn" class="write-btn" style="background:#ef4444;">
                            ğŸ‘ ë¹„ì¶”ì²œ <span id="dislike-count">${post.dislikes || 0}</span>
                        </button>
                    </div>
                    <div class="form-actions" style="margin-top: 2rem; justify-content: flex-start;">
                        <button id="back-to-list-btn" class="write-btn" style="background-color:#64748b; margin-right: auto;">ëª©ë¡ìœ¼ë¡œ</button>
                        ${isAuthor ? authorButtons : ''}
                    </div>
                </div>
                <div id="comments-section">
                    <h3>ëŒ“ê¸€</h3>
                    <ul id="comments-list"></ul>
                    ${appState.currentUser ? `
                        <form id="comment-form" class="comment-form">
                            <textarea id="comment-text" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." required></textarea>
                            <button type="submit" class="write-btn">ë“±ë¡</button>
                        </form>
                    ` : `<p style="text-align:center; color:#64748b;">ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>`}
                </div>
            `;
            
            setupVoteUI(postId);
            renderComments(postId);
            
            document.getElementById('back-to-list-btn').addEventListener('click', () => renderBoardView(boardId, 1));
            if (appState.currentUser) {
                document.getElementById('comment-form')?.addEventListener('submit', (e) => handleCommentSubmit(e, postId));
            }
            if (isAuthor) {
                document.getElementById('edit-post-btn').addEventListener('click', () => renderEditView(postId));
                document.getElementById('delete-post-btn').addEventListener('click', () => handlePostDelete(postId, boardId));
            }
        } else {
            alert("ê²Œì‹œë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            renderBoardView(boardId, 1);
        }
    }

    function renderSearchResultsView(results, queryText) {
        showView('search-results-view');
        const container = document.getElementById('search-results-view');
        
        let resultsHtml = `<h2>'${queryText}' ê²€ìƒ‰ ê²°ê³¼</h2>`;
        if (results.length === 0) {
            resultsHtml += '<p style="text-align:center; padding: 2rem 0;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        } else {
            resultsHtml += `<div class="popular-posts"><ul>`;
            resultsHtml += results.map(post => `
                <li>
                    <a href="#" class="post-link" data-post-id="${post.id}" data-board="${post.board}">
                        <span class="board-name">[${boardNames[post.board]}]</span> ${post.title}
                        <span class="comment-count">[${post.commentCount || 0}]</span>
                    </a>
                </li>
            `).join('');
            resultsHtml += `</ul></div>`;
        }
        container.innerHTML = resultsHtml;
    }
    
    // === ëŒ“ê¸€ ê¸°ëŠ¥ í•¨ìˆ˜ ===

    async function renderComments(postId) {
        const commentsList = document.getElementById('comments-list');
        if (!commentsList) return;
        commentsList.innerHTML = '<li>ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>';

        const commentsCol = collection(db, "posts", postId, "comments");
        const q = query(commentsCol, orderBy("createdAt"));
        const snapshot = await getDocs(q);
        
        const commentsMap = new Map();
        snapshot.docs.forEach(doc => {
            commentsMap.set(doc.id, { id: doc.id, children: [], ...doc.data() });
        });

        const rootComments = [];
        commentsMap.forEach(comment => {
            if (comment.parentId && commentsMap.has(comment.parentId)) {
                commentsMap.get(comment.parentId).children.push(comment);
            } else {
                rootComments.push(comment);
            }
        });

        commentsList.innerHTML = '';
        if (rootComments.length === 0) {
            commentsList.innerHTML = '<li>ì‘ì„±ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
            return;
        }
        rootComments.forEach(comment => {
            const li = createCommentElement(comment);
            commentsList.appendChild(li);
        });
    }

    function createCommentElement(comment) {
        const li = document.createElement('li');
        li.className = 'comment-item';
        li.id = `comment-${comment.id}`;
        const formatDate = (ts) => ts ? new Date(ts.seconds * 1000).toLocaleString('ko-KR') : '';

        li.innerHTML = `
            <div class="comment-header">
                <span class="comment-author">${comment.authorName}</span>
                <span class="comment-date">${formatDate(comment.createdAt)}</span>
            </div>
            <p class="comment-body">${comment.text.replace(/\n/g, '<br>')}</p>
            <div class="comment-actions">
                ${appState.currentUser ? `<button class="reply-btn" data-comment-id="${comment.id}">ë‹µê¸€ ë‹¬ê¸°</button>` : ''}
            </div>
        `;

        if (comment.children.length > 0) {
            const replyList = document.createElement('ul');
            replyList.className = 'reply-list';
            comment.children.forEach(reply => {
                replyList.appendChild(createCommentElement(reply));
            });
            li.appendChild(replyList);
        }
        
        li.querySelector('.reply-btn')?.addEventListener('click', showReplyForm);
        return li;
    }

    function showReplyForm(e) {
        const parentCommentId = e.target.dataset.commentId;
        const parentCommentItem = document.getElementById(`comment-${parentCommentId}`);

        const existingForm = parentCommentItem.querySelector('.reply-form-container');
        if (existingForm) {
            existingForm.remove();
            return;
        }
        
        const formContainer = document.createElement('div');
        formContainer.className = 'reply-form-container';
        formContainer.innerHTML = `
            <form class="comment-form reply-form">
                <textarea placeholder="ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." required></textarea>
                <button type="submit" class="write-btn">ë“±ë¡</button>
            </form>
        `;

        formContainer.querySelector('.reply-form').addEventListener('submit', (event) => {
            handleCommentSubmit(event, appState.currentPostId, parentCommentId);
        });

        parentCommentItem.appendChild(formContainer);
        formContainer.querySelector('textarea').focus();
    }
    
    // === ì¶”ì²œ/ë¹„ì¶”ì²œ ê¸°ëŠ¥ í•¨ìˆ˜ ===

    async function setupVoteUI(postId) {
        const likeBtn = document.getElementById('like-btn');
        const dislikeBtn = document.getElementById('dislike-btn');
        if (!likeBtn || !dislikeBtn) return;

        likeBtn.addEventListener('click', () => handleVote(postId, 1));
        dislikeBtn.addEventListener('click', () => handleVote(postId, -1));

        const user = appState.currentUser;
        if (!user) return;

        const voteRef = doc(db, "posts", postId, "votes", user.uid);
        const snap = await getDoc(voteRef);
        if (snap.exists()) {
            const v = snap.data().value;
            if (v === 1) likeBtn.style.outline = "3px solid rgba(34,197,94,.4)";
            if (v === -1) dislikeBtn.style.outline = "3px solid rgba(239,68,68,.4)";
        }
    }

    async function handleVote(postId, value) {
        const user = appState.currentUser;
        if (!user) { alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."); return; }

        const postRef = doc(db, "posts", postId);
        const voteRef = doc(db, "posts", postId, "votes", user.uid);

        try {
            await runTransaction(db, async (tx) => {
                const [postSnap, voteSnap] = await Promise.all([tx.get(postRef), tx.get(voteRef)]);
                if (!postSnap.exists()) throw new Error("ê²Œì‹œë¬¼ ì—†ìŒ");

                let likes = postSnap.data().likes || 0;
                let dislikes = postSnap.data().dislikes || 0;

                if (!voteSnap.exists()) {
                    if (value === 1) likes += 1;
                    else dislikes += 1;
                    tx.set(voteRef, { value, createdAt: serverTimestamp() });
                } else {
                    const prev = voteSnap.data().value;
                    if (prev === value) {
                        if (value === 1) likes -= 1;
                        else dislikes -= 1;
                        tx.delete(voteRef);
                    } else {
                        if (value === 1) { likes += 1; dislikes -= 1; }
                        else { dislikes += 1; likes -= 1; }
                        tx.update(voteRef, { value, createdAt: serverTimestamp() });
                    }
                }
                tx.update(postRef, { likes, dislikes });
            });

            const latest = (await getDoc(postRef)).data();
            document.getElementById('like-count').textContent = latest.likes || 0;
            document.getElementById('dislike-count').textContent = latest.dislikes || 0;

            const likeBtn = document.getElementById('like-btn');
            const dislikeBtn = document.getElementById('dislike-btn');
            likeBtn.style.outline = "";
            dislikeBtn.style.outline = "";

            const myVote = await getDoc(doc(db, "posts", postId, "votes", user.uid));
            if (myVote.exists()) {
                if (myVote.data().value === 1) likeBtn.style.outline = "3px solid rgba(34,197,94,.4)";
                if (myVote.data().value === -1) dislikeBtn.style.outline = "3px solid rgba(239,68,68,.4)";
            }
        } catch (e) {
            console.error(e);
            alert("íˆ¬í‘œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
    }
    
    // === ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (ì‚¬ìš©ì í–‰ë™ ì²˜ë¦¬) ===

    async function handleSearchSubmit(e) {
        e.preventDefault();
        const queryText = document.getElementById('search-input').value.trim();
        if (!queryText) {
            alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }
        const results = await fetchSearchResults(queryText);
        renderSearchResultsView(results, queryText);
    }

    async function handlePostSubmit(e) {
        e.preventDefault();
        const title = document.getElementById('write-title').value;
        const content = document.getElementById('write-content').value;
        const user = appState.currentUser;

        if (!user) {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            return;
        }

        try {
            const postsCol = collection(db, 'posts');
            await addDoc(postsCol, {
                title, content,
                authorId: user.uid,
                authorName: user.nickname,
                board: appState.currentBoard,
                createdAt: serverTimestamp(),
                views: 0, likes: 0, dislikes: 0, commentCount: 0,
            });
            
            const siteStatsDocRef = doc(db, 'siteStats', 'summary');
            await setDoc(siteStatsDocRef, { totalPosts: increment(1) }, { merge: true });

            alert("ê²Œì‹œë¬¼ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
            renderBoardView(appState.currentBoard, 1);
        } catch (error) {
            console.error("ê²Œì‹œë¬¼ ë“±ë¡ ì˜¤ë¥˜: ", error);
            alert("ê²Œì‹œë¬¼ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
    }

    async function handlePostUpdate(e) {
        e.preventDefault();
        const postId = e.target.dataset.postId;
        const newTitle = document.getElementById('edit-title').value;
        const newContent = document.getElementById('edit-content').value;

        if (!postId || !newTitle.trim() || !newContent.trim()) {
            alert("ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        try {
            const postRef = doc(db, "posts", postId);
            await updateDoc(postRef, {
                title: newTitle,
                content: newContent
            });

            alert("ê²Œì‹œë¬¼ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
            renderPostView(appState.currentBoard, postId);
        } catch (error) {
            console.error("ê²Œì‹œë¬¼ ìˆ˜ì • ì˜¤ë¥˜:", error);
            alert("ê²Œì‹œë¬¼ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
    }

    async function handlePostDelete(postId, boardId) {
        if (!confirm("ì •ë§ë¡œ ê²Œì‹œë¬¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
            return;
        }
        try {
            const postRef = doc(db, "posts", postId);
            await deleteDoc(postRef);
            alert("ê²Œì‹œë¬¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            renderBoardView(boardId, 1);
        } catch (error) {
            console.error("ê²Œì‹œë¬¼ ì‚­ì œ ì˜¤ë¥˜:", error);
            alert("ê²Œì‹œë¬¼ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
    }

    async function handleCommentSubmit(e, postId, parentId = null) {
        e.preventDefault();
        const user = appState.currentUser;
        if (!user) {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            return;
        }

        const textarea = e.target.querySelector('textarea');
        const text = textarea.value.trim();
        if (!text) return;

        try {
            const commentsCol = collection(db, "posts", postId, "comments");
            const commentData = {
                text: text,
                authorId: user.uid,
                authorName: user.nickname,
                createdAt: serverTimestamp(),
            };
            if (parentId) {
                commentData.parentId = parentId;
            }
            await addDoc(commentsCol, commentData);

            const postRef = doc(db, "posts", postId);
            await updateDoc(postRef, { commentCount: increment(1) });
            
            textarea.value = '';
            const formContainer = e.target.closest('.reply-form-container');
            if(formContainer) formContainer.remove();
            renderComments(postId);
        } catch (error) {
            console.error("ëŒ“ê¸€ ë“±ë¡ ì˜¤ë¥˜: ", error);
            alert("ëŒ“ê¸€ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
    }
        
    // --- AUTHENTICATION LOGIC ---
    const userMenuContainer = document.getElementById('user-menu-container');
    const loginModal = document.getElementById('login-modal');
    const signupModal = document.getElementById('signup-modal');

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const userDocRef = doc(db, "users", user.uid);
            const userDoc = await getDoc(userDocRef);
            const nickname = userDoc.exists() ? userDoc.data().nickname : user.email.split('@')[0];
            
            appState.currentUser = { uid: user.uid, email: user.email, nickname: nickname };

            userMenuContainer.innerHTML = `
                <span>${nickname}ë‹˜</span>
                <button id="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
            `;
            document.getElementById('logout-btn').addEventListener('click', () => signOut(auth));
        } else {
            appState.currentUser = null;
            userMenuContainer.innerHTML = `
                <a href="#" id="login-btn">ë¡œê·¸ì¸</a>
                <a href="#" id="signup-btn">íšŒì›ê°€ì…</a>
            `;
            document.getElementById('login-btn').addEventListener('click', (e) => { e.preventDefault(); loginModal.classList.add('show'); });
            document.getElementById('signup-btn').addEventListener('click', (e) => { e.preventDefault(); signupModal.classList.add('show'); });
        }
    });
    
    document.getElementById('signup-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const nickname = document.getElementById('signup-nickname').value;
        const email = document.getElementById('signup-email').value;
        const password = document.getElementById('signup-password').value;

        try {
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;
            await updateProfile(user, { displayName: nickname });
            await setDoc(doc(db, "users", user.uid), { nickname: nickname, email: email });
            alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
            signupModal.classList.remove('show');
        } catch (error) { alert(`íšŒì›ê°€ì… ì‹¤íŒ¨: ${error.message}`); }
    });

    document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        try {
            await signInWithEmailAndPassword(auth, email, password);
            loginModal.classList.remove('show');
        } catch (error) { alert(`ë¡œê·¸ì¸ ì‹¤íŒ¨: ${error.message}`); }
    });

    // --- GLOBAL EVENT LISTENERS ---
    document.querySelectorAll('.modal-overlay').forEach(modal => {
        modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.remove('show'); });
    });
    document.querySelectorAll('.modal-close-btn').forEach(btn => {
        btn.addEventListener('click', () => { btn.closest('.modal-overlay').classList.remove('show'); });
    });

    const sportsGalleryToggle = document.getElementById('sports-gallery-toggle');
    const sportsGalleryDropdown = document.getElementById('sports-gallery-dropdown');

    sportsGalleryToggle.addEventListener('click', (e) => {
        e.preventDefault();
        sportsGalleryDropdown.classList.toggle('show');
    });

    document.addEventListener('click', (e) => {
        if (!document.getElementById('sports-gallery-menu').contains(e.target)) {
            sportsGalleryDropdown.classList.remove('show');
        }
    });

    document.getElementById('app').addEventListener('click', (e) => {
        const navLink = e.target.closest('.nav-link');
        if (navLink && navLink.dataset.board) {
            e.preventDefault();
            renderBoardView(navLink.dataset.board, 1);
            sportsGalleryDropdown.classList.remove('show');
            return;
        }

        const postLink = e.target.closest('.post-link');
        if (postLink) {
            e.preventDefault();
            const postId = postLink.dataset.postId;
            const boardId = postLink.dataset.board;
            renderPostView(boardId, postId);
            return;
        }
    });

    document.getElementById('logo').addEventListener('click', renderMainView);
    document.getElementById('write-post-btn').addEventListener('click', renderWriteView);
    document.getElementById('search-form').addEventListener('submit', handleSearchSubmit);
    
    // Initial Render
    renderMainView();
</script>
</body>
</html>